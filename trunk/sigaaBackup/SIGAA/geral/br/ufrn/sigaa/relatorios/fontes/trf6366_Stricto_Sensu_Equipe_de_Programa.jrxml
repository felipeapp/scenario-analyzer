<?xml version="1.0" encoding="UTF-8"  ?>
<!-- Created with iReport - A designer for JasperReports -->
<!DOCTYPE jasperReport PUBLIC "//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">
<jasperReport
		 name="trf6366_Stricto_Sensu_Equipe_de_Programa"
		 columnCount="1"
		 printOrder="Vertical"
		 orientation="Portrait"
		 pageWidth="595"
		 pageHeight="842"
		 columnWidth="535"
		 columnSpacing="0"
		 leftMargin="30"
		 rightMargin="30"
		 topMargin="2"
		 bottomMargin="1"
		 whenNoDataType="NoPages"
		 isTitleNewPage="false"
		 isSummaryNewPage="false">
	<property name="ireport.scriptlethandling" value="0" />
	<property name="ireport.encoding" value="UTF-8" />
	<import value="java.util.*" />
	<import value="net.sf.jasperreports.engine.*" />
	<import value="net.sf.jasperreports.engine.data.*" />

	<parameter name="programa" isForPrompting="true" class="java.lang.Integer">
		<defaultValueExpression ><![CDATA[new Integer(363)]]></defaultValueExpression>
	</parameter>
	<parameter name="SUBREPORT_DIR" isForPrompting="false" class="java.io.InputStream"/>
	<parameter name="externo" isForPrompting="true" class="java.lang.Integer">
		<defaultValueExpression ><![CDATA[new Integer(-1)]]></defaultValueExpression>
	</parameter>
	<parameter name="P_TITULO" isForPrompting="false" class="java.io.InputStream"/>
	<parameter name="totalDocentes" isForPrompting="false" class="java.lang.Integer">
		<parameterDescription><![CDATA[Total de docentes que estão vinculados a programas de pós stricto sensu.
Cada docente é contabilizado apenas um vez, ou seja, se um docente participar de dois programas ele será contabilizado apenas uma vez]]></parameterDescription>
		<defaultValueExpression ><![CDATA[new Integer(0)]]></defaultValueExpression>
	</parameter>
	<parameter name="subSistema" isForPrompting="false" class="java.lang.String"/>
	<parameter name="subSistemaLink" isForPrompting="false" class="java.lang.String"/>
	<queryString><![CDATA[SELECT *,
       CASE
          WHEN $P{externo}=1 THEN '(DOC. EXTERNOS)'
          WHEN $P{externo}=0 THEN '(DOC. INTERNOS)'
          ELSE ' '
       END AS TIPO_DOCENTE
  FROM (
                SELECT U.ID_UNIDADE,
                       U.NOME AS PROGRAMA,
                       CASE 
                          WHEN S.SIAPE IS NULL THEN DE.MATRICULA
                          ELSE CAST(S.SIAPE AS VARCHAR(15))
                       END AS MATRICULA,
                       CASE 
                          WHEN S.SIAPE IS NULL THEN P2.NOME
                          ELSE P.NOME
                       END AS NOME,
                       IE.NOME AS INSTITUICAO,
                       VE.DENOMINACAO AS VINCULO,
                       NE.DENOMINACAO AS NIVEL,
                       MESTRADO,
                       DOUTORADO,
                       CASE 
                           WHEN EP.ID_DOCENTE_EXTERNO IS NOT NULL THEN 1
                           ELSE 0
                       END AS EXTERNO
                  FROM STRICTO_SENSU.EQUIPE_PROGRAMA EP
                 LEFT JOIN STRICTO_SENSU.nivel_equipe NE ON NE.ID_NIVEL_EQUIPE=EP.ID_NIVEL_EQUIPE
                 INNER JOIN STRICTO_SENSU.vinculo_equipe VE ON VE.ID_VINCULO_EQUIPE=EP.ID_VINCULO_EQUIPE
                 LEFT JOIN RH.servidor S ON S.ID_SERVIDOR=EP.ID_SERVIDOR
                 LEFT JOIN COMUM.PESSOA P ON P.ID_PESSOA=S.ID_PESSOA
                 LEFT JOIN ENSINO.DOCENTE_EXTERNO DE ON DE.ID_DOCENTE_EXTERNO=EP.ID_DOCENTE_EXTERNO
                 LEFT JOIN COMUM.PESSOA P2 ON P2.ID_PESSOA=DE.ID_PESSOA
                 LEFT JOIN COMUM.instituicoes_ensino IE ON IE.ID=DE.ID_INSTITUICAO
                 INNER JOIN COMUM.UNIDADE U ON U.ID_UNIDADE=EP.ID_PROGRAMA
                 WHERE (($P{programa}=-1) OR (EP.ID_PROGRAMA=$P{programa})) -- 363
                   AND EP.ATIVO
) A
WHERE (($P{externo}=-1) OR (EXTERNO=$P{externo})) -- -1 TODOS, 1 EXTERNOS, 0 INTERNOS
ORDER BY PROGRAMA,NOME]]></queryString>

	<field name="id_unidade" class="java.lang.Integer"/>
	<field name="programa" class="java.lang.String"/>
	<field name="matricula" class="java.lang.String"/>
	<field name="nome" class="java.lang.String"/>
	<field name="instituicao" class="java.lang.String"/>
	<field name="vinculo" class="java.lang.String"/>
	<field name="nivel" class="java.lang.String"/>
	<field name="mestrado" class="java.lang.Boolean"/>
	<field name="doutorado" class="java.lang.Boolean"/>
	<field name="externo" class="java.lang.Integer"/>
	<field name="tipo_docente" class="java.lang.String"/>

	<variable name="qtdRegistros" class="java.lang.Integer" resetType="Report" calculation="Count">
		<variableExpression><![CDATA[new Boolean(true)]]></variableExpression>
	</variable>

		<group  name="Programa" >
			<groupExpression><![CDATA[$F{id_unidade}]]></groupExpression>
			<groupHeader>
			<band height="24"  isSplitAllowed="true" >
				<staticText>
					<reportElement
						x="318"
						y="12"
						width="70"
						height="12"
						key="staticText-1"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[NÍVEL]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="1"
						y="12"
						width="48"
						height="12"
						key="staticText-2"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[MATRÍCULA]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="49"
						y="12"
						width="135"
						height="12"
						key="staticText-3"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[NOME]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="184"
						y="12"
						width="38"
						height="12"
						key="staticText-4"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[MESTR.]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="260"
						y="12"
						width="58"
						height="12"
						key="staticText-5"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[VÍNCULO]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="388"
						y="12"
						width="147"
						height="12"
						key="staticText-6"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[INSTITUIÇÃO]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="1"
						y="0"
						width="54"
						height="11"
						key="staticText-8"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="8" isBold="true"/>
					</textElement>
				<text><![CDATA[PROGRAMA:]]></text>
				</staticText>
				<staticText>
					<reportElement
						x="222"
						y="12"
						width="38"
						height="12"
						key="staticText-9"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[DOUTOR.]]></text>
				</staticText>
				<textField isStretchWithOverflow="true" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="55"
						y="-1"
						width="479"
						height="11"
						key="textField-62"
						printWhenGroupChanges="Programa"
						isPrintWhenDetailOverflows="true"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement>
						<font/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{programa}]]></textFieldExpression>
				</textField>
			</band>
			</groupHeader>
			<groupFooter>
			<band height="12"  isSplitAllowed="true" >
				<textField isStretchWithOverflow="false" pattern="##,##0" isBlankWhenNull="false" evaluationTime="Group" evaluationGroup="Programa"  hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="512"
						y="0"
						width="22"
						height="11"
						key="textField-61"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="6"/>
					</textElement>
				<textFieldExpression   class="java.lang.Integer"><![CDATA[$V{Programa_COUNT}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement
						x="449"
						y="0"
						width="53"
						height="11"
						key="staticText-10"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[QUANTIDADE]]></text>
				</staticText>
				<line direction="TopDown">
					<reportElement
						x="0"
						y="-1"
						width="536"
						height="0"
						key="line-9"/>
					<graphicElement stretchType="NoStretch"/>
				</line>
			</band>
			</groupFooter>
		</group>
		<background>
			<band height="0"  isSplitAllowed="true" >
				<printWhenExpression><![CDATA[new Boolean(false)]]></printWhenExpression>
			</band>
		</background>
		<title>
			<band height="18"  isSplitAllowed="true" >
				<subreport  isUsingCache="true">
					<reportElement
						x="-30"
						y="0"
						width="444"
						height="17"
						key="subreport-1"
						isPrintRepeatedValues="false"/>
					<subreportParameter  name="titulo">
						<subreportParameterExpression><![CDATA["RELATÓRIO DA EQUIPE DE UM PROGRAMA "+ $F{tipo_docente}]]></subreportParameterExpression>
					</subreportParameter>
					<subreportParameter  name="subsistema">
						<subreportParameterExpression><![CDATA[$P{subSistema}]]></subreportParameterExpression>
					</subreportParameter>
					<subreportParameter  name="subSistemaLink">
						<subreportParameterExpression><![CDATA[$P{subSistemaLink}]]></subreportParameterExpression>
					</subreportParameter>
					<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					<subreportExpression  class="java.io.InputStream"><![CDATA[this.getClass().getResourceAsStream("br/ufrn/sigaa/relatorios/fontes/tituloUFRN.jasper")]]></subreportExpression>
				</subreport>
			</band>
		</title>
		<pageHeader>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</pageHeader>
		<columnHeader>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</columnHeader>
		<detail>
			<band height="11"  isSplitAllowed="true" >
				<rectangle>
					<reportElement
						mode="Opaque"
						x="1"
						y="1"
						width="534"
						height="9"
						forecolor="#F7F7F7"
						backcolor="#F7F7F7"
						key="rectangle-1">
							<printWhenExpression><![CDATA[new java.lang.Boolean(($V{REPORT_COUNT}.intValue() % 2)==1)]]></printWhenExpression>
						</reportElement>
					<graphicElement stretchType="NoStretch"/>
				</rectangle>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="1"
						y="0"
						width="43"
						height="11"
						key="textField-44"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{matricula}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="49"
						y="0"
						width="135"
						height="11"
						key="textField-45"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{nome}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="184"
						y="0"
						width="38"
						height="11"
						key="textField-47"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{mestrado}.toString()=="true"?"X":""]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="260"
						y="0"
						width="58"
						height="11"
						key="textField-49"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{vinculo}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="388"
						y="0"
						width="147"
						height="11"
						key="textField-51"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font size="4"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{instituicao}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="318"
						y="0"
						width="70"
						height="11"
						key="textField-57"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{nivel}]]></textFieldExpression>
				</textField>
				<textField isStretchWithOverflow="false" isBlankWhenNull="true" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="222"
						y="0"
						width="38"
						height="11"
						key="textField-58"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" leftPadding="2" rightBorder="None" rightBorderColor="#000000" rightPadding="2" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Center" verticalAlignment="Middle">
						<font size="5"/>
					</textElement>
				<textFieldExpression   class="java.lang.String"><![CDATA[$F{doutorado}.toString()=="true"?"X":""]]></textFieldExpression>
				</textField>
			</band>
		</detail>
		<columnFooter>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</columnFooter>
		<pageFooter>
			<band height="0"  isSplitAllowed="true" >
			</band>
		</pageFooter>
		<summary>
			<band height="11"  isSplitAllowed="true" >
				<line direction="TopDown">
					<reportElement
						x="1"
						y="0"
						width="536"
						height="0"
						key="line-8"/>
					<graphicElement stretchType="NoStretch"/>
				</line>
				<staticText>
					<reportElement
						x="388"
						y="0"
						width="114"
						height="11"
						key="staticText-11"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font pdfFontName="Helvetica-Bold" size="7" isBold="true"/>
					</textElement>
				<text><![CDATA[QUANTIDADE DA INSTITUIÇÃO]]></text>
				</staticText>
				<textField isStretchWithOverflow="false" isBlankWhenNull="false" evaluationTime="Now" hyperlinkType="None"  hyperlinkTarget="Self" >
					<reportElement
						x="510"
						y="-1"
						width="22"
						height="12"
						key="textField"/>
					<box topBorder="None" topBorderColor="#000000" leftBorder="None" leftBorderColor="#000000" rightBorder="None" rightBorderColor="#000000" bottomBorder="None" bottomBorderColor="#000000"/>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="6"/>
					</textElement>
				<textFieldExpression   class="java.lang.Integer"><![CDATA[$P{totalDocentes}]]></textFieldExpression>
				</textField>
			</band>
		</summary>
</jasperReport>
